services:
  backend:
    build:
      context: ./Back
      dockerfile: dockerfile
    volumes:
      - ./Back:/app
    working_dir: /app
    image: casaos/backend:latest
    environment:
      - DB_HOST=mariadb
      - DB_USER=casaos
      - DB_PASSWORD=casaos
      - DB_NAME=casaos
    ports:
      - "4000:4000"

  backend_py:
    build:
      context: ./Back_py
      dockerfile: Dockerfile
    volumes:
      - ./Back_py:/app
    working_dir: /app
    image: casaos/backend_py:latest
    environment:
      - DB_HOST=mariadb
      - DB_USER=casaos
      - DB_PASSWORD=casaos
      - DB_NAME=casaos
    ports:
      - "5000:5000"

  frontend:
    build:
      context: ./Front
      dockerfile: dockerfile
    volumes:
      - ./Front:/app
      - /app/node_modules
    image: casaos/frontend:latest
    working_dir: /app
    ports:
      - "4200:4200"
    stdin_open: true
    tty: true

  mariadb:
    image: mariadb:10.6
    restart: unless-stopped
    environment:
      - MYSQL_ROOT_PASSWORD=casaos
      - MYSQL_DATABASE=casaos
      - MYSQL_USER=casaos
      - MYSQL_PASSWORD=casaos
    volumes:
      - db_data:/var/lib/mysql
      - ./Back/scripts:/docker-entrypoint-initdb.d:ro
    ports:
      - "3307:3306"

volumes:
  db_data:
